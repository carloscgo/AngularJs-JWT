var app=angular.module("app",["ngRoute","angular-jwt","angular-storage"]);app.constant("CONFIG",{APIURL:"http://localhost:8504"}).config(["$routeProvider","$httpProvider","jwtInterceptorProvider",function(t,e,o){e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",o.tokenGetter=["store","jwtHelper","$http","$location","CONFIG",function(t,e,o,n,r){var a=t.get("token");return a?e.isTokenExpired(a)?o({url:r.APIURL+"/auth/renewtoken",skipAuthorization:!0,method:"POST",data:{grant_type:"refresh_token",refresh_token:a}}).then(function(e){return(a=e.data.token)?(t.set("token",a),a):(t.remove("token"),void n.path("/login"))},function(){t.remove("token"),n.path("/login")}):a:void 0}],e.interceptors.push("jwtInterceptor"),t.when("/",{redirectTo:"/home"}).when("/home",{templateUrl:"templates/home.html",controller:"homeCtrl",authorization:!0}).when("/login",{templateUrl:"templates/login.html",controller:"loginCtrl",authorization:!1})}]).controller("homeCtrl",["$scope","jwtHelper","contactsFactory","store","$location",function(t,e,o,n,r){var a=n.get("token");if(a){var i=e.decodeToken(a);t.user=i,t.getContacts=function(){o.get().then(function(e){e.data&&0==e.data.code&&(n.set("token",e.data.token),t.contacts=e.data.contactos)})},t.logOut=function(){confirm("Esta seguro de salir?")&&(n.remove("token"),r.path("/login"))}}}]).controller("loginCtrl",["$scope","authFactory","store","$location",function(t,e,o,n){t.login=function(t){e.login(t).then(function(t){t.data&&0==t.data.code&&(o.set("token",t.data.token),n.path("/home"))})}}]).factory("authFactory",["$http","$q","CONFIG",function(t,e,o){return{login:function(n){var r;return r=e.defer(),t({method:"POST",skipAuthorization:!0,url:o.APIURL+"/auth/login",data:$.param(n),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(function(t){r.resolve(t)}).then(function(t){r.reject(t)}),r.promise}}}]).factory("contactsFactory",["$http","$q","CONFIG",function(t,e,o){return{get:function(){var n;return n=e.defer(),t({method:"GET",skipAuthorization:!1,url:o.APIURL+"/contacts"}).then(function(t){n.resolve(t)}).then(function(t){n.reject(t)}),n.promise}}}]).run(["$rootScope","jwtHelper","store","$location",function(t,e,o,n){t.$on("$routeChangeStart",function(){var r=o.get("token")||null;r||n.path("/login")})}]);
